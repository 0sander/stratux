function initWebGL(t){var r=document.getElementById(t);return gl=WebGLUtils.setupWebGL(r)}function log(t){window.console&&window.console.log&&window.console.log(t)}function simpleSetup(t,r,i,e,a,m){var n=loadShader(t,r),x=loadShader(t,i),s=t.createProgram();t.attachShader(s,n),t.attachShader(s,x);for(var o=0;o<e.length;++o)t.bindAttribLocation(s,o,e[o]);t.linkProgram(s);var h=t.getProgramParameter(s,t.LINK_STATUS);if(!h&&!t.isContextLost()){var u=t.getProgramInfoLog(s);return log("Error in program linking:"+u),t.deleteProgram(s),t.deleteProgram(x),t.deleteProgram(n),null}return t.useProgram(s),t.clearColor(a[0],a[1],a[2],a[3]),t.clearDepth(m),t.enable(t.DEPTH_TEST),t.enable(t.BLEND),t.blendFunc(t.SRC_ALPHA,t.ONE_MINUS_SRC_ALPHA),s}function loadShader(t,r){var i=document.getElementById(r);return i?loadShaderScript(t,i.text,i.type):(log("*** Error: shader script '"+r+"' not found"),null)}function loadShaderVertexScript(t,r){return loadShaderScript(t,r,"x-shader/x-vertex")}function loadShaderFragmentScript(t,r){return loadShaderScript(t,r,"x-shader/x-fragment")}function loadShaderScript(t,r,i){if(!r)return log("*** Error: shader script missing"),null;if("x-shader/x-vertex"==i)var e=t.VERTEX_SHADER;else{if("x-shader/x-fragment"!=i)return log("*** Error: shader script of undefined type '"+i+"'"),null;var e=t.FRAGMENT_SHADER}var a=t.createShader(e);t.shaderSource(a,r),t.compileShader(a);var m=t.getShaderParameter(a,t.COMPILE_STATUS);if(!m&&!t.isContextLost()){var n=t.getShaderInfoLog(a);return log("*** Error compiling shader: "+n),t.deleteShader(a),null}return a}function makePaperAirplane(t){var r=1,i=1,e=.33,a=.1,m=0,n=0,x=.5,s=new Float32Array([m,n,-r-x,-i,n,r-x,-a,n,r-x,m,n,-r-x,m,-e,r-x,-a,n,r-x,m,n,-r-x,m,-e,r-x,a,n,r-x,m,n,-r-x,i,n,r-x,a,n,r-x]),o=new Float32Array([0,1,0,0,1,0,0,1,0,1,1,0,1,1,0,1,1,0,-1,1,0,-1,1,0,-1,1,0,0,1,0,0,1,0,0,1,0]),h=new Uint8Array([0,1,2,3,4,5,6,7,8,9,10,11]),u=new Uint8Array([1,0,0,1,1,0,0,1,1,0,0,1,1,0,0,1,1,0,0,1,1,0,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1,0,1]),f={};return f.normalObject=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,f.normalObject),t.bufferData(t.ARRAY_BUFFER,o,t.STATIC_DRAW),f.vertexObject=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,f.vertexObject),t.bufferData(t.ARRAY_BUFFER,s,t.STATIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,null),f.indexObject=t.createBuffer(),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,f.indexObject),t.bufferData(t.ELEMENT_ARRAY_BUFFER,h,t.STATIC_DRAW),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null),f.colorObject=gl.createBuffer(),gl.bindBuffer(gl.ARRAY_BUFFER,f.colorObject),gl.bufferData(gl.ARRAY_BUFFER,u,gl.STATIC_DRAW),f.numIndices=h.length,f}function makeAxis(t){var r=new Float32Array([0,-1,.01,-1,1,.01,1,1,.01,.01,-1,0,.01,1,.25,.01,1,-1,0,.01,-1,1,.01,1,-1,.01,1,-.01,-1,0,-.01,1,.25,-.01,1,-1,0,-.01,-1,1,-.01,1,-1,-.01,1,0,-1,-.01,-1,1,-.01,1,1,-.01]),i=new Float32Array([0,0,1,0,0,1,0,0,1,1,0,0,1,0,0,1,0,0,0,1,0,0,1,0,0,1,0,-1,0,0,-1,0,0,-1,0,0,0,-1,0,0,-1,0,0,-1,0,0,0,-1,0,0,-1,0,0,-1]),e=new Float32Array([1,1,0,1,0,0,0,1,0,0,1,0,1,0,1,1,0,1,1,1,0,1,0,0,0,0,1,0,1,1,0,0,1,0,1,1]),a=new Uint8Array([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17]),m=new Uint8Array([0,1,0,1,0,1,0,1,0,1,0,1,1,0,0,1,1,0,0,1,1,0,0,1,1,1,1,1,0,0,1,1,0,0,1,1,1,0,0,1,1,0,0,1,1,0,0,1,1,1,1,1,0,0,1,1,0,0,1,1,0,1,0,1,0,1,0,1,0,1,0,1]),n={};return n.normalObject=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,n.normalObject),t.bufferData(t.ARRAY_BUFFER,i,t.STATIC_DRAW),n.texCoordObject=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,n.texCoordObject),t.bufferData(t.ARRAY_BUFFER,e,t.STATIC_DRAW),n.vertexObject=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,n.vertexObject),t.bufferData(t.ARRAY_BUFFER,r,t.STATIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,null),n.indexObject=t.createBuffer(),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,n.indexObject),t.bufferData(t.ELEMENT_ARRAY_BUFFER,a,t.STATIC_DRAW),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null),rtval.colorObject=gl.createBuffer(),gl.bindBuffer(gl.ARRAY_BUFFER,rtval.colorObject),gl.bufferData(gl.ARRAY_BUFFER,m,gl.STATIC_DRAW),n.numIndices=a.length,n}function makeBox(t){var r=new Float32Array([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,1,-1,-1,1,-1,-1,1,1,-1,1,1,-1,1,-1,-1,-1,-1,-1,-1,1,-1,-1,-1,1,-1,-1,1,-1,1,-1,-1,1,1,-1,-1,-1,-1,-1,-1,1,-1,1,1,-1]),i=new Float32Array([0,0,1,0,0,1,0,0,1,0,0,1,1,0,0,1,0,0,1,0,0,1,0,0,0,1,0,0,1,0,0,1,0,0,1,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1]),e=new Float32Array([1,1,0,1,0,0,1,0,0,1,0,0,1,0,1,1,1,0,1,1,0,1,0,0,1,1,0,1,0,0,1,0,0,0,1,0,1,1,0,1,0,0,1,0,1,1,0,1]),a=new Uint8Array([0,1,2,0,2,3,4,5,6,4,6,7,8,9,10,8,10,11,12,13,14,12,14,15,16,17,18,16,18,19,20,21,22,20,22,23]),m={};return m.normalObject=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,m.normalObject),t.bufferData(t.ARRAY_BUFFER,i,t.STATIC_DRAW),m.texCoordObject=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,m.texCoordObject),t.bufferData(t.ARRAY_BUFFER,e,t.STATIC_DRAW),m.vertexObject=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,m.vertexObject),t.bufferData(t.ARRAY_BUFFER,r,t.STATIC_DRAW),t.bindBuffer(t.ARRAY_BUFFER,null),m.indexObject=t.createBuffer(),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,m.indexObject),t.bufferData(t.ELEMENT_ARRAY_BUFFER,a,t.STATIC_DRAW),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null),m.numIndices=a.length,m}function makeSphere(t,r,i,e){for(var a=[],m=[],n=[],x=[],s=0;i>=s;++s)for(var o=0;e>=o;++o){var h=s*Math.PI/i,u=2*o*Math.PI/e,f=Math.sin(h),$=Math.sin(u),c=Math.cos(h),l=Math.cos(u),d=l*f,A=c,g=$*f,R=1-o/e,p=s/i;m.push(d),m.push(A),m.push(g),n.push(R),n.push(p),a.push(r*d),a.push(r*A),a.push(r*g)}for(var s=0;i>s;++s)for(var o=0;e>o;++o){var b=s*(e+1)+o,E=b+e+1;x.push(b),x.push(E),x.push(b+1),x.push(E),x.push(E+1),x.push(b+1)}var _={};return _.normalObject=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,_.normalObject),t.bufferData(t.ARRAY_BUFFER,new Float32Array(m),t.STATIC_DRAW),_.texCoordObject=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,_.texCoordObject),t.bufferData(t.ARRAY_BUFFER,new Float32Array(n),t.STATIC_DRAW),_.vertexObject=t.createBuffer(),t.bindBuffer(t.ARRAY_BUFFER,_.vertexObject),t.bufferData(t.ARRAY_BUFFER,new Float32Array(a),t.STATIC_DRAW),_.numIndices=x.length,_.indexObject=t.createBuffer(),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,_.indexObject),t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Uint16Array(x),t.STREAM_DRAW),_}function clearLoadingObjects(){for(var t=0;t<g_loadingObjects.length;++t)g_loadingObjects[t].onreadystatechange=void 0;g_loadingObjects=[]}function loadObj(t,r){var i={loaded:!1};i.ctx=t;var e=new XMLHttpRequest;return e.obj=i,g_loadingObjects.push(e),e.onreadystatechange=function(){processLoadObj(e)},e.open("GET",r,!0),e.send(null),i}function processLoadObj(t){log("req="+t),4==t.readyState&&(g_loadingObjects.splice(g_loadingObjects.indexOf(t),1),doLoadObj(t.obj,t.responseText))}function doLoadObj(t,r){vertexArray=[],normalArray=[],textureArray=[],indexArray=[];var i=[],e=[],a=[],m={},n=0,x={},s=[-1,0];x._unnamed=s;var o=r.split("\n");for(var h in o){var u=o[h].replace(/[ \t]+/g," ").replace(/\s\s*$/,"");if("#"!=u[0]){var f=u.split(" ");if("g"==f[0])s=[indexArray.length,0],x[f[1]]=s;else if("v"==f[0])i.push(parseFloat(f[1])),i.push(parseFloat(f[2])),i.push(parseFloat(f[3]));else if("vt"==f[0])a.push(parseFloat(f[1])),a.push(parseFloat(f[2]));else if("vn"==f[0])e.push(parseFloat(f[1])),e.push(parseFloat(f[2])),e.push(parseFloat(f[3]));else if("f"==f[0]){if(4!=f.length){log("*** Error: face '"+u+"' not handled");continue}for(var $=1;4>$;++$){if(!(f[$]in m)){var c,l,d,A=f[$].split("/");if(1==A.length)c=parseInt(A[0])-1,l=c,d=c;else{if(!(A.length=3))return t.ctx.console.log("*** Error: did not understand face '"+f[$]+"'"),null;c=parseInt(A[0])-1,d=parseInt(A[1])-1,l=parseInt(A[2])-1}var g=0,R=0,p=0;3*c+2<i.length&&(g=i[3*c],R=i[3*c+1],p=i[3*c+2]),vertexArray.push(g),vertexArray.push(R),vertexArray.push(p),g=0,R=0,2*d+1<a.length&&(g=a[2*d],R=a[2*d+1]),textureArray.push(g),textureArray.push(R),g=0,R=0,p=1,3*l+2<e.length&&(g=e[3*l],R=e[3*l+1],p=e[3*l+2]),normalArray.push(g),normalArray.push(R),normalArray.push(p),m[f[$]]=n++}indexArray.push(m[f[$]]),s[1]++}}}}t.normalObject=t.ctx.createBuffer(),t.ctx.bindBuffer(t.ctx.ARRAY_BUFFER,t.normalObject),t.ctx.bufferData(t.ctx.ARRAY_BUFFER,new Float32Array(normalArray),t.ctx.STATIC_DRAW),t.texCoordObject=t.ctx.createBuffer(),t.ctx.bindBuffer(t.ctx.ARRAY_BUFFER,t.texCoordObject),t.ctx.bufferData(t.ctx.ARRAY_BUFFER,new Float32Array(textureArray),t.ctx.STATIC_DRAW),t.vertexObject=t.ctx.createBuffer(),t.ctx.bindBuffer(t.ctx.ARRAY_BUFFER,t.vertexObject),t.ctx.bufferData(t.ctx.ARRAY_BUFFER,new Float32Array(vertexArray),t.ctx.STATIC_DRAW),t.numIndices=indexArray.length,t.indexObject=t.ctx.createBuffer(),t.ctx.bindBuffer(t.ctx.ELEMENT_ARRAY_BUFFER,t.indexObject),t.ctx.bufferData(t.ctx.ELEMENT_ARRAY_BUFFER,new Uint16Array(indexArray),t.ctx.STREAM_DRAW),t.groups=x,t.loaded=!0}function clearLoadingImages(){for(var t=0;t<g_loadingImages.length;++t)g_loadingImages[t].onload=void 0;g_loadingImages=[]}function loadImageTexture(t,r){var i=t.createTexture();t.bindTexture(t.TEXTURE_2D,i),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,1,1,0,t.RGBA,t.UNSIGNED_BYTE,null);var e=new Image;return g_loadingImages.push(e),e.onload=function(){doLoadImageTexture(t,e,i)},e.src=r,i}function doLoadImageTexture(t,r,i){g_loadingImages.splice(g_loadingImages.indexOf(r),1),t.bindTexture(t.TEXTURE_2D,i),t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,r),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_2D,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.bindTexture(t.TEXTURE_2D,null)}WebGLUtils=function(){var t=function(t){return'<table style="background-color: #8CE; width: 100%; height: 100%;"><tr><td align="center"><div style="display: table-cell; vertical-align: middle;"><div style="">'+t+"</div></div></td></tr></table>"},r='This page requires a browser that supports WebGL.<br/><a href="http://get.webgl.org">Click here to upgrade your browser.</a>',i='It doesn\'t appear your computer can support WebGL.<br/><a href="http://get.webgl.org/troubleshooting/">Click here for more information.</a>',e=function(e,m){function n(r){var i=e.parentNode;i&&(i.innerHTML=t(r))}if(!window.WebGLRenderingContext)return n(r),null;var x=a(e,m);return x||n(i),x},a=function(t,r){for(var i=["webgl","experimental-webgl","webkit-3d","moz-webgl"],e=null,a=0;a<i.length;++a){try{e=t.getContext(i[a],r)}catch(m){}if(e)break}return e};return{create3DContext:a,setupWebGL:e}}(),window.requestAnimFrame=function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(t){return window.setTimeout(t,1e3/60)}}(),window.cancelAnimFrame=function(){return window.cancelAnimationFrame||window.webkitCancelAnimationFrame||window.mozCancelAnimationFrame||window.oCancelAnimationFrame||window.msCancelAnimationFrame||window.clearTimeout}(),WebGLDebugUtils=function(){function t(t){if(null==$){$={},c={};for(var r in t)"number"==typeof t[r]&&($[t[r]]=r,c[r]=t[r])}}function r(){if(null==$)throw"WebGLDebugUtils.init(ctx) not called"}function i(t){return r(),void 0!==$[t]}function e(t){r();var i=$[t];return void 0!==i?"gl."+i:"/*UNKNOWN WebGL ENUM*/ 0x"+t.toString(16)}function a(t,r,i,a){var m=f[t];if(void 0!==m){var m=m[r];if(void 0!==m&&m[i]){if("object"==typeof m[i]&&void 0!==m[i].enumBitwiseOr){for(var n=m[i].enumBitwiseOr,x=0,s=[],o=0;o<n.length;++o){var h=c[n[o]];0!==(a&h)&&(x|=h,s.push(e(h)))}return x===a?s.join(" | "):e(a)}return e(a)}}return null===a?"null":void 0===a?"undefined":a.toString()}function m(t,r){for(var i="",e=r.length,m=0;e>m;++m)i+=(0==m?"":", ")+a(t,e,m,r[m]);return i}function n(t,r,i){t.__defineGetter__(i,function(){return r[i]}),t.__defineSetter__(i,function(t){r[i]=t})}function x(r,i,m,s){function o(t,r){return function(){m&&m(r,arguments);var e=t[r].apply(t,arguments),a=s.getError();return 0!=a&&(h[a]=!0,i(a,r,arguments)),e}}s=s||r,t(r),i=i||function(t,r,i){for(var m="",n=i.length,x=0;n>x;++x)m+=(0==x?"":", ")+a(r,n,x,i[x]);u("WebGL error "+e(t)+" in "+r+"("+m+")")};var h={},f={};for(var $ in r)if("function"==typeof r[$])if("getExtension"!=$)f[$]=o(r,$);else{var c=o(r,$);f[$]=function(){var t=c.apply(r,arguments);return x(t,i,m,s)}}else n(f,r,$);return f.getError=function(){for(var t in h)if(h.hasOwnProperty(t)&&h[t])return h[t]=!1,t;return r.NO_ERROR},f}function s(t){var r=t.getParameter(t.MAX_VERTEX_ATTRIBS),i=t.createBuffer();t.bindBuffer(t.ARRAY_BUFFER,i);for(var e=0;r>e;++e)t.disableVertexAttribArray(e),t.vertexAttribPointer(e,4,t.FLOAT,!1,0,0),t.vertexAttrib1f(e,0);t.deleteBuffer(i);for(var a=t.getParameter(t.MAX_TEXTURE_IMAGE_UNITS),e=0;a>e;++e)t.activeTexture(t.TEXTURE0+e),t.bindTexture(t.TEXTURE_CUBE_MAP,null),t.bindTexture(t.TEXTURE_2D,null);for(t.activeTexture(t.TEXTURE0),t.useProgram(null),t.bindBuffer(t.ARRAY_BUFFER,null),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null),t.bindFramebuffer(t.FRAMEBUFFER,null),t.bindRenderbuffer(t.RENDERBUFFER,null),t.disable(t.BLEND),t.disable(t.CULL_FACE),t.disable(t.DEPTH_TEST),t.disable(t.DITHER),t.disable(t.SCISSOR_TEST),t.blendColor(0,0,0,0),t.blendEquation(t.FUNC_ADD),t.blendFunc(t.ONE,t.ZERO),t.clearColor(0,0,0,0),t.clearDepth(1),t.clearStencil(-1),t.colorMask(!0,!0,!0,!0),t.cullFace(t.BACK),t.depthFunc(t.LESS),t.depthMask(!0),t.depthRange(0,1),t.frontFace(t.CCW),t.hint(t.GENERATE_MIPMAP_HINT,t.DONT_CARE),t.lineWidth(1),t.pixelStorei(t.PACK_ALIGNMENT,4),t.pixelStorei(t.UNPACK_ALIGNMENT,4),t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,!1),t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!1),t.UNPACK_COLORSPACE_CONVERSION_WEBGL&&t.pixelStorei(t.UNPACK_COLORSPACE_CONVERSION_WEBGL,t.BROWSER_DEFAULT_WEBGL),t.polygonOffset(0,0),t.sampleCoverage(1,!1),t.scissor(0,0,t.canvas.width,t.canvas.height),t.stencilFunc(t.ALWAYS,0,4294967295),t.stencilMask(4294967295),t.stencilOp(t.KEEP,t.KEEP,t.KEEP),t.viewport(0,0,t.canvas.width,t.canvas.height),t.clear(t.COLOR_BUFFER_BIT|t.DEPTH_BUFFER_BIT|t.STENCIL_BUFFER_BIT);t.getError(););}function o(t){function r(t){return"function"==typeof t?t:function(r){t.handleEvent(r)}}function i(t){var r=t.addEventListener;t.addEventListener=function(i,e){switch(i){case"webglcontextlost":_(e);break;case"webglcontextrestored":v(e);break;default:r.apply(t,arguments)}}}function e(){for(var t=Object.keys(E),r=0;r<t.length;++r)delete E[t]}function a(){++R,d||g==R&&t.loseContext()}function m(t,r){var i=t[r];return function(){if(a(),!d){var r=i.apply(t,arguments);return r}}}function x(){for(var t=0;t<A.length;++t){var r=A[t];r instanceof WebGLBuffer?u.deleteBuffer(r):r instanceof WebGLFramebuffer?u.deleteFramebuffer(r):r instanceof WebGLProgram?u.deleteProgram(r):r instanceof WebGLRenderbuffer?u.deleteRenderbuffer(r):r instanceof WebGLShader?u.deleteShader(r):r instanceof WebGLTexture&&u.deleteTexture(r)}}function o(t){return{statusMessage:t,preventDefault:function(){p=!0}}}function h(t){for(var r in t)"function"==typeof t[r]?f[r]=m(t,r):n(f,t,r);f.getError=function(){if(a(),!d)for(var t;t=u.getError();)E[t]=!0;for(var t in E)if(E[t])return delete E[t],t;return f.NO_ERROR};for(var i=["createBuffer","createFramebuffer","createProgram","createRenderbuffer","createShader","createTexture"],e=0;e<i.length;++e){var x=i[e];f[x]=function(r){return function(){if(a(),d)return null;var i=r.apply(t,arguments);return i.__webglDebugContextLostId__=l,A.push(i),i}}(t[x])}for(var s=["getActiveAttrib","getActiveUniform","getBufferParameter","getContextAttributes","getAttachedShaders","getFramebufferAttachmentParameter","getParameter","getProgramParameter","getProgramInfoLog","getRenderbufferParameter","getShaderParameter","getShaderInfoLog","getShaderSource","getTexParameter","getUniform","getUniformLocation","getVertexAttrib"],e=0;e<s.length;++e){var x=s[e];f[x]=function(r){return function(){return a(),d?null:r.apply(t,arguments)}}(f[x])}for(var o=["isBuffer","isEnabled","isFramebuffer","isProgram","isRenderbuffer","isShader","isTexture"],e=0;e<o.length;++e){var x=o[e];f[x]=function(r){return function(){return a(),d?!1:r.apply(t,arguments)}}(f[x])}return f.checkFramebufferStatus=function(r){return function(){return a(),d?f.FRAMEBUFFER_UNSUPPORTED:r.apply(t,arguments)}}(f.checkFramebufferStatus),f.getAttribLocation=function(r){return function(){return a(),d?-1:r.apply(t,arguments)}}(f.getAttribLocation),f.getVertexAttribOffset=function(r){return function(){return a(),d?0:r.apply(t,arguments)}}(f.getVertexAttribOffset),f.isContextLost=function(){return d},f}var u,f,$=[],c=[],f={},l=1,d=!1,A=[],g=0,R=0,p=!1,b=0,E={};t.getContext=function(r){return function(){var i=r.apply(t,arguments);if(i instanceof WebGLRenderingContext){if(i!=u){if(u)throw"got different context";u=i,f=h(u)}return f}return i}}(t.getContext);var _=function(t){$.push(r(t))},v=function(t){c.push(r(t))};return i(t),t.loseContext=function(){if(!d){for(d=!0,g=0,++l;u.getError(););e(),E[u.CONTEXT_LOST_WEBGL]=!0;var r=o("context lost"),i=$.slice();setTimeout(function(){for(var e=0;e<i.length;++e)i[e](r);b>=0&&setTimeout(function(){t.restoreContext()},b)},0)}},t.restoreContext=function(){d&&c.length&&setTimeout(function(){if(!p)throw"can not restore. webglcontestlost listener did not call event.preventDefault";x(),s(u),d=!1,R=0,p=!1;for(var t=c.slice(),r=o("context restored"),i=0;i<t.length;++i)t[i](r)},0)},t.loseContextInNCalls=function(t){if(d)throw"You can not ask a lost contet to be lost";g=R+t},t.getNumCalls=function(){return R},t.setRestoreTimeout=function(t){b=t},t}var h=function(t){window.console&&window.console.log&&window.console.log(t)},u=function(t){window.console&&window.console.error?window.console.error(t):h(t)},f={enable:{1:{0:!0}},disable:{1:{0:!0}},getParameter:{1:{0:!0}},drawArrays:{3:{0:!0}},drawElements:{4:{0:!0,2:!0}},createShader:{1:{0:!0}},getShaderParameter:{2:{1:!0}},getProgramParameter:{2:{1:!0}},getShaderPrecisionFormat:{2:{0:!0,1:!0}},getVertexAttrib:{2:{1:!0}},vertexAttribPointer:{6:{2:!0}},bindTexture:{2:{0:!0}},activeTexture:{1:{0:!0}},getTexParameter:{2:{0:!0,1:!0}},texParameterf:{3:{0:!0,1:!0}},texParameteri:{3:{0:!0,1:!0,2:!0}},texImage2D:{9:{0:!0,2:!0,6:!0,7:!0},6:{0:!0,2:!0,3:!0,4:!0}},texSubImage2D:{9:{0:!0,6:!0,7:!0},7:{0:!0,4:!0,5:!0}},copyTexImage2D:{8:{0:!0,2:!0}},copyTexSubImage2D:{8:{0:!0}},generateMipmap:{1:{0:!0}},compressedTexImage2D:{7:{0:!0,2:!0}},compressedTexSubImage2D:{8:{0:!0,6:!0}},bindBuffer:{2:{0:!0}},bufferData:{3:{0:!0,2:!0}},bufferSubData:{3:{0:!0}},getBufferParameter:{2:{0:!0,1:!0}},pixelStorei:{2:{0:!0,1:!0}},readPixels:{7:{4:!0,5:!0}},bindRenderbuffer:{2:{0:!0}},bindFramebuffer:{2:{0:!0}},checkFramebufferStatus:{1:{0:!0}},framebufferRenderbuffer:{4:{0:!0,1:!0,2:!0}},framebufferTexture2D:{5:{0:!0,1:!0,2:!0}},getFramebufferAttachmentParameter:{3:{0:!0,1:!0,2:!0}},getRenderbufferParameter:{2:{0:!0,1:!0}},renderbufferStorage:{4:{0:!0,1:!0}},clear:{1:{0:{enumBitwiseOr:["COLOR_BUFFER_BIT","DEPTH_BUFFER_BIT","STENCIL_BUFFER_BIT"]}}},depthFunc:{1:{0:!0}},blendFunc:{2:{0:!0,1:!0}},blendFuncSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},blendEquation:{1:{0:!0}},blendEquationSeparate:{2:{0:!0,1:!0}},stencilFunc:{3:{0:!0}},stencilFuncSeparate:{4:{0:!0,1:!0}},stencilMaskSeparate:{2:{0:!0}},stencilOp:{3:{0:!0,1:!0,2:!0}},stencilOpSeparate:{4:{0:!0,1:!0,2:!0,3:!0}},cullFace:{1:{0:!0}},frontFace:{1:{0:!0}},drawArraysInstancedANGLE:{4:{0:!0}},drawElementsInstancedANGLE:{5:{0:!0,2:!0}},blendEquationEXT:{1:{0:!0}}},$=null,c=null;return{init:t,mightBeEnum:i,glEnumToString:e,glFunctionArgToString:a,glFunctionArgsToString:m,makeDebugContext:x,makeLostContextSimulatingCanvas:o,resetToInitialState:s}}();var g_loadingObjects=[],g_loadingImages=[];Framerate=function(t){this.numFramerates=10,this.framerateUpdateInterval=500,this.id=t,this.renderTime=-1,this.framerates=[],self=this;var r=function(){self.updateFramerate()};setInterval(r,this.framerateUpdateInterval)},Framerate.prototype.updateFramerate=function(){for(var t=0,r=0;r<this.framerates.length;++r)t+=this.framerates[r];var i=t/this.framerates.length;i=Math.round(i),document.getElementById(this.id).innerHTML="Framerate:"+i+"fps"},Framerate.prototype.snapshot=function(){if(this.renderTime<0)this.renderTime=(new Date).getTime();else{var t=(new Date).getTime(),r=t-this.renderTime;if(0==r)return;var i=1e3/r;for(this.framerates.push(i);this.framerates.length>this.numFramerates;)this.framerates.shift();this.renderTime=t}},J3DIHasCSSMatrix=!1,J3DIHasCSSMatrixCopy=!1,J3DIMatrix4=function(t){if(this.$matrix=J3DIHasCSSMatrix?new WebKitCSSMatrix:new Object,"object"==typeof t){if("length"in t&&t.length>=16)return void this.load(t);if(t instanceof J3DIMatrix4)return void this.load(t)}this.makeIdentity()},J3DIMatrix4.prototype.load=function(){if(1==arguments.length&&"object"==typeof arguments[0]){var t;if(arguments[0]instanceof J3DIMatrix4)return t=arguments[0].$matrix,this.$matrix.m11=t.m11,this.$matrix.m12=t.m12,this.$matrix.m13=t.m13,this.$matrix.m14=t.m14,this.$matrix.m21=t.m21,this.$matrix.m22=t.m22,this.$matrix.m23=t.m23,this.$matrix.m24=t.m24,this.$matrix.m31=t.m31,this.$matrix.m32=t.m32,this.$matrix.m33=t.m33,this.$matrix.m34=t.m34,this.$matrix.m41=t.m41,this.$matrix.m42=t.m42,this.$matrix.m43=t.m43,void(this.$matrix.m44=t.m44);if(t=arguments[0],"length"in t&&t.length>=16)return this.$matrix.m11=t[0],this.$matrix.m12=t[1],this.$matrix.m13=t[2],this.$matrix.m14=t[3],this.$matrix.m21=t[4],this.$matrix.m22=t[5],this.$matrix.m23=t[6],this.$matrix.m24=t[7],this.$matrix.m31=t[8],this.$matrix.m32=t[9],this.$matrix.m33=t[10],this.$matrix.m34=t[11],this.$matrix.m41=t[12],this.$matrix.m42=t[13],this.$matrix.m43=t[14],void(this.$matrix.m44=t[15])}this.makeIdentity()},J3DIMatrix4.prototype.getAsArray=function(){return[this.$matrix.m11,this.$matrix.m12,this.$matrix.m13,this.$matrix.m14,this.$matrix.m21,this.$matrix.m22,this.$matrix.m23,this.$matrix.m24,this.$matrix.m31,this.$matrix.m32,this.$matrix.m33,this.$matrix.m34,this.$matrix.m41,this.$matrix.m42,this.$matrix.m43,this.$matrix.m44]},J3DIMatrix4.prototype.getAsFloat32Array=function(){if(J3DIHasCSSMatrixCopy){var t=new Float32Array(16);return this.$matrix.copy(t),t}return new Float32Array(this.getAsArray())},J3DIMatrix4.prototype.setUniform=function(t,r,i){void 0==J3DIMatrix4.setUniformArray&&(J3DIMatrix4.setUniformWebGLArray=new Float32Array(16),J3DIMatrix4.setUniformArray=new Array(16)),J3DIHasCSSMatrixCopy?this.$matrix.copy(J3DIMatrix4.setUniformWebGLArray):(J3DIMatrix4.setUniformArray[0]=this.$matrix.m11,J3DIMatrix4.setUniformArray[1]=this.$matrix.m12,J3DIMatrix4.setUniformArray[2]=this.$matrix.m13,J3DIMatrix4.setUniformArray[3]=this.$matrix.m14,J3DIMatrix4.setUniformArray[4]=this.$matrix.m21,J3DIMatrix4.setUniformArray[5]=this.$matrix.m22,J3DIMatrix4.setUniformArray[6]=this.$matrix.m23,J3DIMatrix4.setUniformArray[7]=this.$matrix.m24,J3DIMatrix4.setUniformArray[8]=this.$matrix.m31,J3DIMatrix4.setUniformArray[9]=this.$matrix.m32,J3DIMatrix4.setUniformArray[10]=this.$matrix.m33,J3DIMatrix4.setUniformArray[11]=this.$matrix.m34,J3DIMatrix4.setUniformArray[12]=this.$matrix.m41,J3DIMatrix4.setUniformArray[13]=this.$matrix.m42,J3DIMatrix4.setUniformArray[14]=this.$matrix.m43,J3DIMatrix4.setUniformArray[15]=this.$matrix.m44,J3DIMatrix4.setUniformWebGLArray.set(J3DIMatrix4.setUniformArray)),t.uniformMatrix4fv(r,i,J3DIMatrix4.setUniformWebGLArray)},J3DIMatrix4.prototype.makeIdentity=function(){this.$matrix.m11=1,this.$matrix.m12=0,this.$matrix.m13=0,this.$matrix.m14=0,this.$matrix.m21=0,this.$matrix.m22=1,this.$matrix.m23=0,this.$matrix.m24=0,this.$matrix.m31=0,this.$matrix.m32=0,this.$matrix.m33=1,this.$matrix.m34=0,this.$matrix.m41=0,this.$matrix.m42=0,this.$matrix.m43=0,this.$matrix.m44=1},J3DIMatrix4.prototype.transpose=function(){var t=this.$matrix.m12;this.$matrix.m12=this.$matrix.m21,this.$matrix.m21=t,t=this.$matrix.m13,this.$matrix.m13=this.$matrix.m31,this.$matrix.m31=t,t=this.$matrix.m14,this.$matrix.m14=this.$matrix.m41,this.$matrix.m41=t,t=this.$matrix.m23,this.$matrix.m23=this.$matrix.m32,this.$matrix.m32=t,t=this.$matrix.m24,this.$matrix.m24=this.$matrix.m42,this.$matrix.m42=t,t=this.$matrix.m34,this.$matrix.m34=this.$matrix.m43,this.$matrix.m43=t},J3DIMatrix4.prototype.invert=function(){if(J3DIHasCSSMatrix)return void(this.$matrix=this.$matrix.inverse());var t=this._determinant4x4();return Math.abs(t)<1e-8?null:(this._makeAdjoint(),this.$matrix.m11/=t,this.$matrix.m12/=t,this.$matrix.m13/=t,this.$matrix.m14/=t,this.$matrix.m21/=t,this.$matrix.m22/=t,this.$matrix.m23/=t,this.$matrix.m24/=t,this.$matrix.m31/=t,this.$matrix.m32/=t,this.$matrix.m33/=t,this.$matrix.m34/=t,this.$matrix.m41/=t,this.$matrix.m42/=t,this.$matrix.m43/=t,void(this.$matrix.m44/=t))},J3DIMatrix4.prototype.translate=function(t,r,i){if("object"==typeof t&&"length"in t){var e=t;t=e[0],r=e[1],i=e[2]}else void 0==t&&(t=0),void 0==r&&(r=0),void 0==i&&(i=0);if(J3DIHasCSSMatrix)return void(this.$matrix=this.$matrix.translate(t,r,i));var a=new J3DIMatrix4;a.$matrix.m41=t,a.$matrix.m42=r,a.$matrix.m43=i,this.multiply(a)},J3DIMatrix4.prototype.scale=function(t,r,i){if("object"==typeof t&&"length"in t){var e=t;t=e[0],r=e[1],i=e[2]}else void 0==t&&(t=1),void 0==i?void 0==r?(r=t,i=t):i=1:void 0==r&&(r=t);if(J3DIHasCSSMatrix)return void(this.$matrix=this.$matrix.scale(t,r,i));var a=new J3DIMatrix4;a.$matrix.m11=t,a.$matrix.m22=r,a.$matrix.m33=i,this.multiply(a)},J3DIMatrix4.prototype.rotate=function(t,r,i,e){if("object"==typeof r&&"length"in r){var a=r;r=a[0],i=a[1],e=a[2]}else if(1==arguments.length)r=0,i=0,e=1;else if(3==arguments.length)return this.rotate(t,1,0,0),this.rotate(r,0,1,0),void this.rotate(i,0,0,1);if(J3DIHasCSSMatrix)return void(this.$matrix=this.$matrix.rotateAxisAngle(r,i,e,t));t=t/180*Math.PI,t/=2;var m=Math.sin(t),n=Math.cos(t),x=m*m,s=Math.sqrt(r*r+i*i+e*e);0==s?(r=0,i=0,e=1):1!=s&&(r/=s,i/=s,e/=s);var o=new J3DIMatrix4;if(1==r&&0==i&&0==e)o.$matrix.m11=1,o.$matrix.m12=0,o.$matrix.m13=0,o.$matrix.m21=0,o.$matrix.m22=1-2*x,o.$matrix.m23=2*m*n,o.$matrix.m31=0,o.$matrix.m32=-2*m*n,o.$matrix.m33=1-2*x,o.$matrix.m14=o.$matrix.m24=o.$matrix.m34=0,o.$matrix.m41=o.$matrix.m42=o.$matrix.m43=0,o.$matrix.m44=1;else if(0==r&&1==i&&0==e)o.$matrix.m11=1-2*x,o.$matrix.m12=0,o.$matrix.m13=-2*m*n,o.$matrix.m21=0,o.$matrix.m22=1,o.$matrix.m23=0,o.$matrix.m31=2*m*n,o.$matrix.m32=0,o.$matrix.m33=1-2*x,o.$matrix.m14=o.$matrix.m24=o.$matrix.m34=0,o.$matrix.m41=o.$matrix.m42=o.$matrix.m43=0,o.$matrix.m44=1;else if(0==r&&0==i&&1==e)o.$matrix.m11=1-2*x,o.$matrix.m12=2*m*n,o.$matrix.m13=0,o.$matrix.m21=-2*m*n,o.$matrix.m22=1-2*x,o.$matrix.m23=0,o.$matrix.m31=0,o.$matrix.m32=0,o.$matrix.m33=1,o.$matrix.m14=o.$matrix.m24=o.$matrix.m34=0,o.$matrix.m41=o.$matrix.m42=o.$matrix.m43=0,o.$matrix.m44=1;else{var h=r*r,u=i*i,f=e*e;o.$matrix.m11=1-2*(u+f)*x,o.$matrix.m12=2*(r*i*x+e*m*n),o.$matrix.m13=2*(r*e*x-i*m*n),o.$matrix.m21=2*(i*r*x-e*m*n),o.$matrix.m22=1-2*(f+h)*x,o.$matrix.m23=2*(i*e*x+r*m*n),o.$matrix.m31=2*(e*r*x+i*m*n),o.$matrix.m32=2*(e*i*x-r*m*n),o.$matrix.m33=1-2*(h+u)*x,o.$matrix.m14=o.$matrix.m24=o.$matrix.m34=0,o.$matrix.m41=o.$matrix.m42=o.$matrix.m43=0,o.$matrix.m44=1}this.multiply(o)},J3DIMatrix4.prototype.multiply=function(t){if(J3DIHasCSSMatrix)return void(this.$matrix=this.$matrix.multiply(t.$matrix));var r=t.$matrix.m11*this.$matrix.m11+t.$matrix.m12*this.$matrix.m21+t.$matrix.m13*this.$matrix.m31+t.$matrix.m14*this.$matrix.m41,i=t.$matrix.m11*this.$matrix.m12+t.$matrix.m12*this.$matrix.m22+t.$matrix.m13*this.$matrix.m32+t.$matrix.m14*this.$matrix.m42,e=t.$matrix.m11*this.$matrix.m13+t.$matrix.m12*this.$matrix.m23+t.$matrix.m13*this.$matrix.m33+t.$matrix.m14*this.$matrix.m43,a=t.$matrix.m11*this.$matrix.m14+t.$matrix.m12*this.$matrix.m24+t.$matrix.m13*this.$matrix.m34+t.$matrix.m14*this.$matrix.m44,m=t.$matrix.m21*this.$matrix.m11+t.$matrix.m22*this.$matrix.m21+t.$matrix.m23*this.$matrix.m31+t.$matrix.m24*this.$matrix.m41,n=t.$matrix.m21*this.$matrix.m12+t.$matrix.m22*this.$matrix.m22+t.$matrix.m23*this.$matrix.m32+t.$matrix.m24*this.$matrix.m42,x=t.$matrix.m21*this.$matrix.m13+t.$matrix.m22*this.$matrix.m23+t.$matrix.m23*this.$matrix.m33+t.$matrix.m24*this.$matrix.m43,s=t.$matrix.m21*this.$matrix.m14+t.$matrix.m22*this.$matrix.m24+t.$matrix.m23*this.$matrix.m34+t.$matrix.m24*this.$matrix.m44,o=t.$matrix.m31*this.$matrix.m11+t.$matrix.m32*this.$matrix.m21+t.$matrix.m33*this.$matrix.m31+t.$matrix.m34*this.$matrix.m41,h=t.$matrix.m31*this.$matrix.m12+t.$matrix.m32*this.$matrix.m22+t.$matrix.m33*this.$matrix.m32+t.$matrix.m34*this.$matrix.m42,u=t.$matrix.m31*this.$matrix.m13+t.$matrix.m32*this.$matrix.m23+t.$matrix.m33*this.$matrix.m33+t.$matrix.m34*this.$matrix.m43,f=t.$matrix.m31*this.$matrix.m14+t.$matrix.m32*this.$matrix.m24+t.$matrix.m33*this.$matrix.m34+t.$matrix.m34*this.$matrix.m44,$=t.$matrix.m41*this.$matrix.m11+t.$matrix.m42*this.$matrix.m21+t.$matrix.m43*this.$matrix.m31+t.$matrix.m44*this.$matrix.m41,c=t.$matrix.m41*this.$matrix.m12+t.$matrix.m42*this.$matrix.m22+t.$matrix.m43*this.$matrix.m32+t.$matrix.m44*this.$matrix.m42,l=t.$matrix.m41*this.$matrix.m13+t.$matrix.m42*this.$matrix.m23+t.$matrix.m43*this.$matrix.m33+t.$matrix.m44*this.$matrix.m43,d=t.$matrix.m41*this.$matrix.m14+t.$matrix.m42*this.$matrix.m24+t.$matrix.m43*this.$matrix.m34+t.$matrix.m44*this.$matrix.m44;this.$matrix.m11=r,this.$matrix.m12=i,this.$matrix.m13=e,this.$matrix.m14=a,this.$matrix.m21=m,this.$matrix.m22=n,this.$matrix.m23=x,this.$matrix.m24=s,this.$matrix.m31=o,this.$matrix.m32=h,this.$matrix.m33=u,this.$matrix.m34=f,this.$matrix.m41=$,this.$matrix.m42=c,this.$matrix.m43=l,this.$matrix.m44=d},J3DIMatrix4.prototype.divide=function(t){this.$matrix.m11/=t,this.$matrix.m12/=t,this.$matrix.m13/=t,this.$matrix.m14/=t,this.$matrix.m21/=t,this.$matrix.m22/=t,this.$matrix.m23/=t,this.$matrix.m24/=t,this.$matrix.m31/=t,this.$matrix.m32/=t,this.$matrix.m33/=t,this.$matrix.m34/=t,this.$matrix.m41/=t,this.$matrix.m42/=t,this.$matrix.m43/=t,this.$matrix.m44/=t},J3DIMatrix4.prototype.ortho=function(t,r,i,e,a,m){var n=(t+r)/(t-r),x=(e+i)/(e-i),s=(m+a)/(m-a),o=new J3DIMatrix4;o.$matrix.m11=2/(t-r),o.$matrix.m12=0,o.$matrix.m13=0,o.$matrix.m14=0,o.$matrix.m21=0,o.$matrix.m22=2/(e-i),o.$matrix.m23=0,o.$matrix.m24=0,o.$matrix.m31=0,o.$matrix.m32=0,o.$matrix.m33=-2/(m-a),o.$matrix.m34=0,o.$matrix.m41=n,o.$matrix.m42=x,o.$matrix.m43=s,o.$matrix.m44=1,this.multiply(o)},J3DIMatrix4.prototype.frustum=function(t,r,i,e,a,m){var n=new J3DIMatrix4,x=(r+t)/(r-t),s=(e+i)/(e-i),o=-(m+a)/(m-a),h=-(2*m*a)/(m-a);n.$matrix.m11=2*a/(r-t),n.$matrix.m12=0,n.$matrix.m13=0,n.$matrix.m14=0,n.$matrix.m21=0,n.$matrix.m22=2*a/(e-i),n.$matrix.m23=0,n.$matrix.m24=0,n.$matrix.m31=x,n.$matrix.m32=s,n.$matrix.m33=o,n.$matrix.m34=-1,n.$matrix.m41=0,n.$matrix.m42=0,n.$matrix.m43=h,n.$matrix.m44=0,this.multiply(n)},J3DIMatrix4.prototype.perspective=function(t,r,i,e){var a=Math.tan(t*Math.PI/360)*i,m=-a,n=r*m,x=r*a;this.frustum(n,x,m,a,i,e)},J3DIMatrix4.prototype.lookat=function(t,r,i,e,a,m,n,x,s){if("object"==typeof i&&"length"in i){var o=i;n=o[0],x=o[1],s=o[2],o=r,e=o[0],a=o[1],m=o[2],o=t,t=o[0],r=o[1],i=o[2]}var h=new J3DIMatrix4,u=t-e,f=r-a,$=i-m,c=Math.sqrt(u*u+f*f+$*$);c&&(u/=c,f/=c,$/=c);var l=n,d=x,A=s;xx=d*$-A*f,xy=-l*$+A*u,xz=l*f-d*u,l=f*xz-$*xy,d=-u*xz+$*xx,l=u*xy-f*xx,c=Math.sqrt(xx*xx+xy*xy+xz*xz),c&&(xx/=c,xy/=c,xz/=c),c=Math.sqrt(l*l+d*d+A*A),c&&(l/=c,d/=c,A/=c),h.$matrix.m11=xx,h.$matrix.m12=xy,h.$matrix.m13=xz,h.$matrix.m14=0,h.$matrix.m21=l,h.$matrix.m22=d,h.$matrix.m23=A,h.$matrix.m24=0,h.$matrix.m31=u,h.$matrix.m32=f,h.$matrix.m33=$,h.$matrix.m34=0,h.$matrix.m41=0,h.$matrix.m42=0,h.$matrix.m43=0,h.$matrix.m44=1,h.translate(-t,-r,-i),this.multiply(h)},J3DIMatrix4.prototype.decompose=function(t,r,e,a,m){if(0==this.$matrix.m44)return!1;var n,x,s,o,h,n=void 0!=t&&"length"in t?t:new J3DIVector3,x=void 0!=r&&"length"in r?r:new J3DIVector3,s=void 0!=e&&"length"in e?e:new J3DIVector3,o=void 0!=a&&"length"in a?a:new J3DIVector3,h=void 0!=m&&"length"in m?m:new Array(4),u=new J3DIMatrix4(this);
u.divide(u.$matrix.m44);var f=new J3DIMatrix4(u);if(f.$matrix.m14=0,f.$matrix.m24=0,f.$matrix.m34=0,f.$matrix.m44=1,0==f._determinant4x4())return!1;if(0!=u.$matrix.m14||0!=u.$matrix.m24||0!=u.$matrix.m34){var $=[u.$matrix.m14,u.$matrix.m24,u.$matrix.m34,u.$matrix.m44],c=new J3DIMatrix4(f);c.invert();var l=new J3DIMatrix4(c);l.transpose(),l.multVecMatrix(h,$),u.$matrix.m14=u.$matrix.m24=u.$matrix.m34=0,u.$matrix.m44=1}else h[0]=h[1]=h[2]=0,h[3]=1;n[0]=u.$matrix.m41,u.$matrix.m41=0,n[1]=u.$matrix.m42,u.$matrix.m42=0,n[2]=u.$matrix.m43,u.$matrix.m43=0;var d=new J3DIVector3(u.$matrix.m11,u.$matrix.m12,u.$matrix.m13),A=new J3DIVector3(u.$matrix.m21,u.$matrix.m22,u.$matrix.m23),g=new J3DIVector3(u.$matrix.m31,u.$matrix.m32,u.$matrix.m33);s[0]=d.vectorLength(),d.divide(s[0]),o[0]=d.dot(A),A.combine(d,1,-o[0]),s[1]=A.vectorLength(),A.divide(s[1]),o[0]/=s[1],o[1]=A.dot(g),g.combine(d,1,-o[1]),o[2]=A.dot(g),g.combine(A,1,-o[2]),s[2]=g.vectorLength(),g.divide(s[2]),o[1]/=s[2],o[2]/=s[2];var R=new J3DIVector3(A);if(R.cross(g),d.dot(R)<0)for(i=0;3>i;i++)s[i]*=-1,row[0][i]*=-1,row[1][i]*=-1,row[2][i]*=-1;if(x[1]=Math.asin(g[0]),0!=Math.cos(x[1]))x[0]=Math.atan2(-g[1],g[2]),x[2]=Math.atan2(-A[0],d[0]);else{x[2]=0;var p=Math.sin(x[1]);x[0]=0>p?Math.acos((d[2]+A[1])/(1-p))+x[2]:Math.asin((A[2]+d[1])/(p+1))-x[2]}var b=180/Math.PI;return x[0]*=b,x[1]*=b,x[2]*=b,!0},J3DIMatrix4.prototype._determinant2x2=function(t,r,i,e){return t*e-r*i},J3DIMatrix4.prototype._determinant3x3=function(t,r,i,e,a,m,n,x,s){return t*this._determinant2x2(a,m,x,s)-e*this._determinant2x2(r,i,x,s)+n*this._determinant2x2(r,i,a,m)},J3DIMatrix4.prototype._determinant4x4=function(){var t=this.$matrix.m11,r=this.$matrix.m12,i=this.$matrix.m13,e=this.$matrix.m14,a=this.$matrix.m21,m=this.$matrix.m22,n=this.$matrix.m23,x=this.$matrix.m24,s=this.$matrix.m31,o=this.$matrix.m32,h=this.$matrix.m33,u=this.$matrix.m34,f=this.$matrix.m41,$=this.$matrix.m42,c=this.$matrix.m43,l=this.$matrix.m44;return t*this._determinant3x3(m,o,$,n,h,c,x,u,l)-r*this._determinant3x3(a,s,f,n,h,c,x,u,l)+i*this._determinant3x3(a,s,f,m,o,$,x,u,l)-e*this._determinant3x3(a,s,f,m,o,$,n,h,c)},J3DIMatrix4.prototype._makeAdjoint=function(){var t=this.$matrix.m11,r=this.$matrix.m12,i=this.$matrix.m13,e=this.$matrix.m14,a=this.$matrix.m21,m=this.$matrix.m22,n=this.$matrix.m23,x=this.$matrix.m24,s=this.$matrix.m31,o=this.$matrix.m32,h=this.$matrix.m33,u=this.$matrix.m34,f=this.$matrix.m41,$=this.$matrix.m42,c=this.$matrix.m43,l=this.$matrix.m44;this.$matrix.m11=this._determinant3x3(m,o,$,n,h,c,x,u,l),this.$matrix.m21=-this._determinant3x3(a,s,f,n,h,c,x,u,l),this.$matrix.m31=this._determinant3x3(a,s,f,m,o,$,x,u,l),this.$matrix.m41=-this._determinant3x3(a,s,f,m,o,$,n,h,c),this.$matrix.m12=-this._determinant3x3(r,o,$,i,h,c,e,u,l),this.$matrix.m22=this._determinant3x3(t,s,f,i,h,c,e,u,l),this.$matrix.m32=-this._determinant3x3(t,s,f,r,o,$,e,u,l),this.$matrix.m42=this._determinant3x3(t,s,f,r,o,$,i,h,c),this.$matrix.m13=this._determinant3x3(r,m,$,i,n,c,e,x,l),this.$matrix.m23=-this._determinant3x3(t,a,f,i,n,c,e,x,l),this.$matrix.m33=this._determinant3x3(t,a,f,r,m,$,e,x,l),this.$matrix.m43=-this._determinant3x3(t,a,f,r,m,$,i,n,c),this.$matrix.m14=-this._determinant3x3(r,m,o,i,n,h,e,x,u),this.$matrix.m24=this._determinant3x3(t,a,s,i,n,h,e,x,u),this.$matrix.m34=-this._determinant3x3(t,a,s,r,m,o,e,x,u),this.$matrix.m44=this._determinant3x3(t,a,s,r,m,o,i,n,h)},J3DIVector3=function(t,r,i){this.load(t,r,i)},J3DIVector3.prototype.load=function(t,r,i){"object"==typeof t&&"length"in t?(this[0]=t[0],this[1]=t[1],this[2]=t[2]):"number"==typeof t?(this[0]=t,this[1]=r,this[2]=i):(this[0]=0,this[1]=0,this[2]=0)},J3DIVector3.prototype.getAsArray=function(){return[this[0],this[1],this[2]]},J3DIVector3.prototype.getAsFloat32Array=function(){return new Float32Array(this.getAsArray())},J3DIVector3.prototype.vectorLength=function(){return Math.sqrt(this[0]*this[0]+this[1]*this[1]+this[2]*this[2])},J3DIVector3.prototype.divide=function(t){this[0]/=t,this[1]/=t,this[2]/=t},J3DIVector3.prototype.cross=function(t){var r=this[1]*t[2]-this[2]*t[1],i=-this[0]*t[2]+this[2]*t[0];this[2]=this[0]*t[1]-this[1]*t[0],this[0]=r,this[1]=i},J3DIVector3.prototype.dot=function(t){return this[0]*t[0]+this[1]*t[1]+this[2]*t[2]},J3DIVector3.prototype.combine=function(t,r,i){this[0]=r*this[0]+i*t[0],this[1]=r*this[1]+i*t[1],this[2]=r*this[2]+i*t[2]},J3DIVector3.prototype.multVecMatrix=function(t){var r=this[0],i=this[1],e=this[2];this[0]=t.$matrix.m41+r*t.$matrix.m11+i*t.$matrix.m21+e*t.$matrix.m31,this[1]=t.$matrix.m42+r*t.$matrix.m12+i*t.$matrix.m22+e*t.$matrix.m32,this[2]=t.$matrix.m43+r*t.$matrix.m13+i*t.$matrix.m23+e*t.$matrix.m33;var a=t.$matrix.m44+r*t.$matrix.m14+i*t.$matrix.m24+e*t.$matrix.m34;1!=a&&0!=a&&(this[0]/=a,this[1]/=a,this[2]/=a)},J3DIVector3.prototype.toString=function(){return"["+this[0]+","+this[1]+","+this[2]+"]"};
